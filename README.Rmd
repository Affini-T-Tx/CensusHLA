---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# CensusHLA

<!-- badges: start -->

<!-- badges: end -->

# Setup

## System requirements

Functions which plot frequencies by us map and shape files do have some system level requirements. Specifically `sf`,`h3jsr`,`rnaturalearth` and `usmap` may give you some trouble.

## Census API Key

-   Get US Census API Code, Follow instructions [here](https://www.hrecht.com/censusapi/articles/getting-started.html#api-key-setup), get your key [here](http://api.census.gov/data/key_signup.html)

Here is an example chunk to add to your `~/.Renviron` file to provide a system level environmental variable

```{r, eval=FALSE}
## Add key to .Renviron
CENSUS_KEY=<YOUR CENSUS API CODE HERE>
```

## Gragert 2013 Frequency Data

-   Obtain Gragert 2013 Frequency data for HLA-A,B,and C by visiting their site [here](https://frequency.nmdp.org/)
-   You must login with an OpenID account (Yahoo, Google are provided by default) and accept the data use click-through terms.
- Once you've accepted the terms, download A,B,and C xlsx files and put them in the clone package code in `inst/extdata` as `A|B|C.xlsx`
+ Now you've got the data, you can run the `data-raw/import_gragert2013_data.R` script to generate the data files.

## Catchment Spatial Files

Run `data-raw/import_delNero2024_catchment.R`

## Census Spatial Files

Run `data-raw/import_census2020_tiger_shapefiles.R`

Can take some time, ~30 minutes to download all state, county, and per state tract shape files

## Prepare `data` files

1) Run `data-raw/import_gragert2013_data.R` to import the Gragert 2013 data
2) Run `data-raw/nmdp_racegroups.R`
3) Run `data-raw/valid_state_names.R`
4) Run `data-raw/census_adjusted_nmdp_hla_frequencies_by_state.R`
5) Run `data-raw/census_adjusted_nmdp_hla_frequencies_by_county.R`. Due to the large number of {counties * alleles}, by default this R script only stores the top 20 most abundant HLAs by loci in the US.  If you want to run them all, or are looking for a specific one, you can comment out the lines which filter the included alleles.
6) Run `data-raw/add_catchment_calculations_and_data.R`. - Note - this will take a while as it works by census tract and by state. And there are many census tracts! Be default it does this for A11, A02, and B58:01.  You can add as you see fit.


) Document the Package
) Restart your session
) Attempt to run a vignette

# Examples
